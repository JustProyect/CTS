<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Universidad Andina de Cusco - Filial Pto Maldonado ‚Äî Calculadora CTS</title>

<!-- CDN librer√≠as para export PDF / captura PNG -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#f4f6fb;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#2b6de5;
    --accent-2:#2563eb;
    --success:#16a34a;
    --danger:#ef4444;
    --panel:#f7f9fc;
    --soft:#f1f5f9;
    --yellow:#fff7ed;
  }

  *{box-sizing:border-box;font-family:Inter,system-ui,Arial,sans-serif}

  body{
    margin:0;
    background:linear-gradient(180deg,#f7fbff 0%,var(--bg) 100%);
    padding:28px;
    color:#0f172a;
  }

  .wrap{max-width:1180px;margin:0 auto}

  .header{
    background:linear-gradient(90deg,#0b3a7a,#1f67c1);
    color:white;border-radius:10px;padding:18px;margin-bottom:18px;box-shadow:0 6px 18px rgba(15,23,42,0.06)
  }
  .header h1{margin:0;font-size:20px}
  .header p{margin:4px 0 0}
  .header .sub{font-weight:600;margin-top:6px}

  .app{display:grid;grid-template-columns:1fr 420px;gap:20px;align-items:start}
  @media (max-width:1100px){ .app{grid-template-columns:1fr} }

  .card{background:var(--card);border-radius:10px;padding:16px;box-shadow:0 6px 24px rgba(16,24,40,0.06)}

  .panel-title{display:flex;align-items:center;gap:10px;margin-bottom:12px}
  .panel-title h2{margin:0;font-size:16px}
  .muted{color:var(--muted);font-size:13px}

  .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:600px){ .form-grid{grid-template-columns:1fr} }

  .field{display:flex;flex-direction:column;margin-bottom:10px}
  label{font-size:13px;color:#374151;margin-bottom:6px}
  input[type="number"], input[type="date"], select{
    padding:10px;border-radius:8px;border:1px solid #e6e9ef;background:white;font-size:14px;
  }
  .full{grid-column:1 / -1}
  .hint{background:var(--soft);padding:10px;border-radius:8px;color:var(--muted);font-size:13px;margin:8px 0}

  .btn-primary{
    background:linear-gradient(90deg,var(--accent),var(--accent-2));
    color:white;padding:12px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;width:100%;
    box-shadow:0 8px 20px rgba(37,99,235,0.16)
  }

  .btns-row{display:flex;gap:8px;margin:12px 0;flex-wrap:wrap}
  .btn-ghost{padding:8px 12px;border-radius:999px;border:1px solid #e6edf9;background:white;cursor:pointer;font-size:13px}
  .btn-excel{color:#047857;border:1px solid rgba(4,120,87,.12)}
  .btn-pdf{color:#b91c1c;border:1px solid rgba(185,28,28,.12)}
  .btn-png{color:#075985;border:1px solid rgba(7,89,133,.12)}

  .result-line{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px dashed #eef2ff;font-size:14px;color:#263238}
  @media (max-width:420px){ .result-line{flex-direction:column;gap:4px} }

  .kpi{background:#fff7ed;padding:8px;border-radius:6px;min-width:120px;text-align:right;font-weight:700}
  @media (max-width:420px){ .kpi{width:100%;text-align:left} }

  .summary{margin-top:12px;padding-top:12px;border-top:1px solid #f1f5f9}
  .summary .row{display:flex;justify-content:space-between;padding:6px 0;color:var(--muted)}
  .summary .row strong{color:#0f172a}
  .total-cts{background:#fef3e8;padding:10px;border-radius:8px;margin-top:10px;display:flex;justify-content:space-between;align-items:center}
  .total-final{background:#ecfdf5;border-radius:8px;padding:10px;margin-top:10px;display:flex;justify-content:space-between;align-items:center;color:var(--success)}
  .small-note{font-size:12px;color:var(--muted);margin-top:8px}

  .months-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
  @media (max-width:600px){ .months-grid{grid-template-columns:repeat(2,1fr)} }
  @media (max-width:420px){ .months-grid{grid-template-columns:1fr} }
  .months-grid input{padding:8px;border-radius:8px;border:1px solid #e6e9ef}

</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1>Universidad Andina de Cusco - Filial Puerto Maldonado</h1>
      <p class="sub">Escuela Profesional de Contabilidad ‚Äî <strong></strong>VII</p>
    </div>

    <div class="app">
      <!-- Left: Form -->
      <div class="card">
        <div class="panel-title">
          <div style="width:36px;height:36px;border-radius:8px;background:#eef2ff;display:flex;align-items:center;justify-content:center">üìã</div>
          <div>
            <h2>Datos para el c√°lculo</h2>
            <div class="muted">Calcula tu Compensaci√≥n por Tiempo de Servicios</div>
          </div>
        </div>

        <div style="margin-top:8px">
          <div class="field full">
            <label>Fecha de ingreso</label>
            <input type="date" id="fechaIngreso" />
          </div>

          <div class="field full" style="margin-top:6px">
            <label>Pr√≥ximo dep√≥sito CTS</label>
            <select id="proximo">
              <option>May 2025 - Oct 2025 (Pago: 31 Oct)</option>
              <option>Nov 2025 - Apr 2026 (Pago: 30 Apr)</option>
            </select>
          </div>

          <div class="form-grid" style="margin-top:8px">
            <div class="field">
              <label>üí∞ Sueldo b√°sico (S/)</label>
              <input type="number" id="sueldo" min="0" step="0.01" value="1200">
            </div>
            <div class="field">
              <label>üë®‚Äçüë©‚Äçüëß Asignaci√≥n familiar (S/)</label>
              <input type="number" id="asig" min="0" step="0.01" value="0">
            </div>

            <div class="field">
              <label>üéÅ Gratificaci√≥n (S/)</label>
              <input type="number" id="grat" min="0" step="0.01" value="0">
            </div>
            <div class="field">
              <label>üìå Conceptos fijos (S/)</label>
              <input type="number" id="conceptos" min="0" step="0.01" value="0">
            </div>

            <div class="field">
              <label>‚ùó D√≠as de inasistencia</label>
              <input type="number" id="inasist" min="0" value="0">
            </div>
            <div class="field">
              <label>üî¢ D√≠as adicionales computables</label>
              <input type="number" id="diasAdd" min="0" value="0">
            </div>

            <!-- NUEVO: Meses computables -->
            <div class="field full" style="margin-top:6px">
              <label>üóìÔ∏è Meses computables</label>
              <!-- n√∫mero (1-12). Puedes ajustar max si quieres limitar a 6 -->
              <input type="number" id="meses" min="1" max="12" value="6" step="1">
              <div class="muted" style="font-size:12px;margin-top:6px">Ingresa la cantidad de meses que desea computar (ej: 6)</div>
            </div>

          </div>

          <div class="hint">
            <strong>Variables (otros ingresos)</strong><br>
            Solo se considerar√° el promedio si hay valores en al menos <strong>3 meses</strong>.
          </div>

          <div class="months-grid">
            <input type="number" id="mayo" placeholder="Mayo (S/)" min="0" step="0.01">
            <input type="number" id="junio" placeholder="Junio (S/)" min="0" step="0.01">
            <input type="number" id="julio" placeholder="Julio (S/)" min="0" step="0.01">
            <input type="number" id="agosto" placeholder="Agosto (S/)" min="0" step="0.01">
            <input type="number" id="sept" placeholder="Sept (S/)" min="0" step="0.01">
            <input type="number" id="oct" placeholder="Oct (S/)" min="0" step="0.01">
          </div>

          <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
            <button class="btn-primary" id="calcularBtn">üìä Calcular CTS</button>
          </div>
        </div>
      </div>

      <!-- Right: Results -->
      <div class="card results" id="resultCard">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2 style="margin:0">Resultados del c√°lculo</h2>
          <div class="muted" style="font-size:13px">Per√∫ ‚Äî 2025</div>
        </div>

        <div class="note" style="margin-top:12px">
          La CTS se calcula sobre <strong id="infoMeses">6 meses</strong> de trabajo con un m√°ximo de 180 d√≠as computables.
        </div>

        <div class="btns-row">
          <button class="btn-ghost btn-excel" id="btnExcel">üì• Excel</button>
          <button class="btn-ghost btn-pdf" id="btnPDF">üìÑ PDF</button>
          <button class="btn-ghost btn-png" id="btnPNG">üñº PNG</button>
        </div>

        <div id="results">
          <div class="result-line">
            <div class="label">Meses computables:</div>
            <div id="outMeses">6 meses</div>
          </div>

          <div class="result-line">
            <div class="label">D√≠as adicionales:</div>
            <div id="outDiasAdd">0 d√≠as</div>
          </div>

          <div class="result-line">
            <div class="label">CTS por meses:</div>
            <div class="kpi" id="outCTSmes">S/ 0.00</div>
          </div>

          <div class="result-line">
            <div class="label">CTS por d√≠a:</div>
            <div id="outCTSdia">S/ 0.00</div>
          </div>

          <div class="result-line">
            <div class="label">Descuento por inasistencias:</div>
            <div style="color:var(--danger);font-weight:700" id="outDescuento">S/ 0.00</div>
          </div>

          <div class="summary">
            <div class="row"><div>Sueldo b√°sico:</div><div id="sumSueldo">S/ 0.00</div></div>
            <div class="row"><div>+ Asignaci√≥n familiar:</div><div id="sumAsig">S/ 0.00</div></div>
            <div class="row"><div>+ Gratificaci√≥n (1/6):</div><div id="sumGrat">S/ 0.00</div></div>
            <div class="row"><div>+ Conceptos fijos:</div><div id="sumFijos">S/ 0.00</div></div>
            <div class="row"><div>= Base para CTS:</div><div id="outBase">S/ 0.00</div></div>

            <div class="total-cts">
              <div><strong>TOTAL CTS:</strong></div>
              <div id="outTotalCTS" style="font-weight:800">S/ 0.00</div>
            </div>

            <div class="total-final">
              <div><strong>TOTAL Sueldo + CTS:</strong></div>
              <div id="outTotalSueldCTS" style="font-weight:800">S/ 0.00</div>
            </div>

            <div class="small-note">Nota: c√°lculo orientativo. Para casos complejos consulte a RR.HH.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // Elementos
  const sueldoEl = document.getElementById('sueldo');
  const asigEl = document.getElementById('asig');
  const gratEl = document.getElementById('grat');
  const conceptosEl = document.getElementById('conceptos');
  const inasistEl = document.getElementById('inasist');
  const diasAddEl = document.getElementById('diasAdd');
  const mesesEl = document.getElementById('meses'); // <- nuevo

  const mayo = document.getElementById('mayo');
  const junio = document.getElementById('junio');
  const julio = document.getElementById('julio');
  const agosto = document.getElementById('agosto');
  const sept = document.getElementById('sept');
  const octu = document.getElementById('oct');

  // Salidas
  const outMeses = document.getElementById('outMeses');
  const outDiasAdd = document.getElementById('outDiasAdd');
  const outBase = document.getElementById('outBase');
  const outCTSmes = document.getElementById('outCTSmes');
  const outCTSdia = document.getElementById('outCTSdia');
  const outDescuento = document.getElementById('outDescuento');
  const outTotalCTS = document.getElementById('outTotalCTS');
  const outTotalSueldCTS = document.getElementById('outTotalSueldCTS');

  const sumSueldo = document.getElementById('sumSueldo');
  const sumAsig = document.getElementById('sumAsig');
  const sumGrat = document.getElementById('sumGrat');
  const sumFijos = document.getElementById('sumFijos');

  const infoMeses = document.getElementById('infoMeses');

  // Format
  function formatMon(n){
    return 'S/ ' + Number(n || 0).toLocaleString('es-PE', {minimumFractionDigits:2, maximumFractionDigits:2});
  }

  function calcularCTS(){
    const sueldo = Number(sueldoEl.value) || 0;
    const asig = Number(asigEl.value) || 0;
    const grat = Number(gratEl.value) || 0;
    const conceptos = Number(conceptosEl.value) || 0;
    const inasist = Number(inasistEl.value) || 0;
    const diasAdd = Number(diasAddEl.value) || 0;

    // leer meses desde input (si falla usar 6)
    let meses = Number(mesesEl.value);
    if (!meses || meses < 1) meses = 6;

    // variables (otros ingresos)
    const arrVars = [Number(mayo.value)||0, Number(junio.value)||0, Number(julio.value)||0, Number(agosto.value)||0, Number(sept.value)||0, Number(octu.value)||0];
    const nonZero = arrVars.filter(v => v > 0);
    let promedioVars = 0;
    if (nonZero.length >= 3) promedioVars = nonZero.reduce((a,b)=>a+b,0) / nonZero.length;

    // gratificaci√≥n prorrateada 1/6
    const gratProrr = grat / 6;

    const baseCTS = sueldo + asig + gratProrr + conceptos + promedioVars;

    // uso de "meses" din√°mico
    const ctsPorMeses = baseCTS * (meses / 12);
    const ctsPorDia = ctsPorMeses / 180;
    const descuento = ctsPorDia * inasist;
    const totalCTS = Math.max(0, ctsPorMeses - descuento);
    const totalSueldoCTS = sueldo + totalCTS;

    // llenar UI
    outMeses.textContent = meses + ' meses';
    outDiasAdd.textContent = diasAdd + ' d√≠as';
    outBase.textContent = formatMon(baseCTS);
    outCTSmes.textContent = formatMon(ctsPorMeses);
    outCTSdia.textContent = formatMon(ctsPorDia);
    outDescuento.textContent = formatMon(descuento);
    outTotalCTS.textContent = formatMon(totalCTS);
    outTotalSueldCTS.textContent = formatMon(totalSueldoCTS);

    sumSueldo.textContent = formatMon(sueldo);
    sumAsig.textContent = formatMon(asig);
    sumGrat.textContent = formatMon(gratProrr);
    sumFijos.textContent = formatMon(conceptos);

    infoMeses.textContent = meses + ' meses';
  }

  document.getElementById('calcularBtn').addEventListener('click', calcularCTS);

  // calcular al inicio con valores por defecto
  window.addEventListener('load', calcularCTS);

  // Export: Excel (CSV)
  document.getElementById('btnExcel').addEventListener('click', () => {
    const rows = [
      ['Item','Valor'],
      ['Meses computables', outMeses.textContent],
      ['D√≠as adicionales', outDiasAdd.textContent],
      ['Base para CTS', outBase.textContent],
      ['CTS por meses', outCTSmes.textContent],
      ['CTS por d√≠a', outCTSdia.textContent],
      ['Descuento por inasistencias', outDescuento.textContent],
      ['TOTAL CTS', outTotalCTS.textContent],
      ['TOTAL Sueldo + CTS', outTotalSueldCTS.textContent]
    ];
    const csv = rows.map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
    const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'cts_resultados.csv';
    a.click();
    URL.revokeObjectURL(url);
  });

  // Export: PDF (jsPDF)
  document.getElementById('btnPDF').addEventListener('click', async () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({unit:'pt', format:'a4'});
    doc.setFontSize(14);
    doc.text('Calculadora CTS - Resultados', 40, 50);
    doc.setFontSize(11);

    const lines = [
      ['Meses computables', outMeses.textContent],
      ['D√≠as adicionales', outDiasAdd.textContent],
      ['Base para CTS', outBase.textContent],
      ['CTS por meses', outCTSmes.textContent],
      ['CTS por d√≠a', outCTSdia.textContent],
      ['Descuento por inasistencias', outDescuento.textContent],
      ['TOTAL CTS', outTotalCTS.textContent],
      ['TOTAL Sueldo + CTS', outTotalSueldCTS.textContent]
    ];

    let y = 90;
    lines.forEach(([label, val])=>{
      doc.text(`${label}: ${val}`, 40, y);
      y += 20;
      if (y > 750) { doc.addPage(); y = 40; }
    });

    doc.save('cts_resultados.pdf');
  });

  // Export: PNG
  document.getElementById('btnPNG').addEventListener('click', async () => {
    const node = document.getElementById('resultCard');
    html2canvas(node, { scale: 2, backgroundColor: null }).then(canvas => {
      const url = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url;
      a.download = 'cts_resultado.png';
      a.click();
    }).catch(err=>{
      alert('Error al generar PNG: ' + err.message);
    });
  });

  // recalcular al cambiar inputs (ligero debounce)
  const inputs = Array.from(document.querySelectorAll('input[type="number"], input[type="date"], select'));
  inputs.forEach(inp=>{
    let t;
    inp.addEventListener('input', ()=>{
      clearTimeout(t);
      t = setTimeout(calcularCTS, 200);
    });
  });
</script>
</body>
</html>

